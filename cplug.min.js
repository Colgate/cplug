!function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var o=new this;t=!1;for(var a in i)o[a]="function"==typeof i[a]&&"function"==typeof s[a]&&e.test(i[a])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(a,i[a]):i[a];return n.prototype=o,n.prototype.constructor=n,n.extend=arguments.callee,n}}(),"undefined"!=typeof window.cplug&&cplug.close();var cpURL="https://rawgit.com/Colgate/cplug/master/cplug.js",cplugModel=Class.extend({version:"1.1.0",userCache:{},debug:!0,settings:{autoWootEnabled:!0,autoJoinEnabled:!0,notifier:{enabled:!0,showWhenFocused:!1,events:{djAdvance:!0,chatMention:!0}},notifyTimeout:5e3},init:function(){1==this.settings.notifier.enabled&&"granted"!=window.Notification.permission&&window.Notification.requestPermission(),this.functions.chatLog("#00ffff","Running cplug v"+this.version),this.proxy={onDJAdvance:$.proxy(this.onDJAdvance,this),onChatCommand:$.proxy(this.handleChatCommands,this),onUserJoin:$.proxy(this.onUserJoin,this),onUserLeave:$.proxy(this.onUserLeave,this),onVoteUpdate:$.proxy(this.onVoteUpdate,this),onChat:$.proxy(this.onChat,this)},this.initListeners(),setTimeout(function(){cplug.debug&&console.log("Generating User Cache"),cplug.functions.genCache()},1e3),this.loadSettings(),this.initUI()},close:function(){this.killListeners(),$("#cplug_icon, #cplug_menu").remove(),$("#now-playing-time, #volume").css("right","54px"),$("#history-button").css("right","0px"),$("#cplug_css").remove()},loadSettings:function(){"undefined"!=typeof localStorage.cpSettings&&(this.settings=JSON.parse(localStorage.cpSettings))},saveSettings:function(){localStorage.cpSettings=JSON.stringify(this.settings)},initListeners:function(){this.debug&&console.log("Initializing event listeners"),API.on(API.ADVANCE,this.proxy.onDJAdvance),API.on(API.CHAT_COMMAND,this.proxy.onChatCommand),API.on(API.USER_JOIN,this.proxy.onUserJoin),API.on(API.USER_LEAVE,this.proxy.onUserLeave),API.on(API.VOTE_UPDATE,this.proxy.onVoteUpdate),API.on(API.CHAT,this.proxy.onChat)},initUI:function(){$("#now-playing-time, #volume").css("right","118px"),$("#history-button").css("right","54px"),$("#history-button").after('<div style="position:absolute; right:0px; width:54px; height:54px; background-image:url(\'https://bug.dj/cplug_icon.png\'); cursor:pointer;" id="cplug_icon"></div>'),$("#cplug_icon").mouseover(function(){$('<div id="tooltip" style="top: 60px; left: 1525px;" class="bottom"><div class="arrow-up"></div><span>cplug</span></div>').appendTo("body")}),$("#cplug_settings").mouseout(function(){$("#tooltip").remove()});var t='<style type="text/css" id="cplug_css">#cplug_settings .tab-menu{top:15px;margin-left:2%;width:96%}#cplug_settings .tab-menu button{width:50%}#cplug_settings .tab-menu button:first-child{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none}#cplug_settings .left{position:relative;float:left;width:50%;padding-left:20px;}#cplug_settings .right{position:relative;float:right;width:45%}#cplug_settings .container{position:relative}#cplug_settings .container .item{position:relative;margin-top:6px;height:25px;cursor:pointer}#cplug_settings .container .item i{top:2px;left:0;display:none}#cplug_settings .container .item.selected i{display:block}#cplug_settings .container .item span{position:absolute;left:17px;margin-left:10px;color:#808691}#cplug_settings .container .item.s-bg{display:none}#cplug_settings .container .cap{position:relative;top:6px;width:149px;height:68px}#cplug_settings .container .cap .title{position:relative;color:#808691}#cplug_settings .container .cap .value{position:relative;float:right;color:#808691;text-align:right}#cplug_settings .container .cap .counts{position:relative;margin-top:5px;margin-left:3px;max-width:145px;height:25px;text-align:justify;-ms-text-justify:distribute-all-lines;text-justify:distribute-all-lines}#cplug_settings .container .cap .counts .count{display:inline-block;width:23px;height:15px;vertical-align:top;font-size:14px}#cplug_settings .container .cap .counts .stretch{display:inline-block;width:135px;font-size:0;line-height:0}#cplug_settings .container .cap .slider{position:relative;width:150px;height:18px}#cplug_settings .container .cap .slider .bar{position:absolute;top:5px;left:0;width:100%;height:6px;border-radius:10px;background:#282c35}#cplug_settings .container .cap .slider .circle{position:absolute;top:0;left:115px;width:15px;height:15px;border-radius:50%;background:#808691}#cplug_settings .container .cap .slider .hit{position:absolute;top:0;left:7.5px;width:100%;height:17px;cursor:pointer}#cplug_settings .container label{position:absolute;top:8px;color:#808691;font-size:16px}#cplug_settings .container .refresh{position:absolute;top:85px;color:#808691}#cplug_settings .container button{position:absolute;top:37px;max-width:300px;width:90%;height:39px;background:#282c35;color:#808691;font-size:16px;font-family:"Open Sans",sans-serif;cursor:pointer}#cplug_settings .container button:hover{background:#f04f30;color:#eee}#cplug_settings .container .dropdown{position:absolute;top:37px;float:none;max-width:300px;width:90%}</style>';$("head").append(t),$("#cplug_icon").click(function(){cplug.toggleUI()}),$('<div id="cplug_menu" style="padding: 10px 25px; position:absolute; float: left; top:-832px; right: 345px; height:350px; width: 400px; background: #1c1f25;z-index: 10"></div>').appendTo("#room");var e='<center><h2>cplug <small class="v"> version '+this.version+'</small></h2><br /><div id="cplug_settings" class="user-content settings" style="left: 220px; width: 400px;"><div class="container"></div></div>';$(e).appendTo("#cplug_menu"),$(".v").css("font-size","60%"),this.functions.menu.addHeader("General"),this.functions.menu.addItem("AutoWoot","cps_aw","left","autoWootEnabled"),this.functions.menu.addItem("AutoJoin","cps_aj","right","autoJoinEnabled"),this.functions.menu.addHeader("Notifications"),this.functions.menu.addItem("Enabled","cps_n_e","left","notifier","enabled"),this.functions.menu.addItem("Show On Focus","cps_n_f","right","notifier","showWhenFocused"),this.functions.menu.addHeader("Notification Types"),this.functions.menu.addItem("DJ Advance","cps_n_t_dja","left","notifier","events","djAdvance"),this.functions.menu.addItem("Chat Mention","cps_n_t_cm","right","notifier","events","chatMention")},toggleUI:function(){"54px"!=$("#cplug_menu").css("top")?$("#cplug_menu").animate({top:"54px"},500):$("#cplug_menu").animate({top:"-"+$("#cplug_menu").css("height")},500)},killListeners:function(){this.debug&&console.log("Killing event listeners"),API.off(API.ADVANCE,this.proxy.onDJAdvance),API.off(API.CHAT_COMMAND,this.proxy.onChatCommand),API.off(API.USER_JOIN,this.proxy.onUserJoin),API.off(API.USER_LEAVE,this.proxy.onUserLeave),API.off(API.VOTE_UPDATE,this.proxy.onVoteUpdate),API.off(API.CHAT,this.proxy.onChat)},onUserJoin:function(t){this.functions.chatLog("#CC33FF",t.username+" joined the room"),void 0==this.userCache[t.id]&&(this.userCache[t.id]=t)},onUserLeave:function(t){this.functions.chatLog("#CC33FF",t.username+" left the room")},onDJAdvance:function(t){this.settings.notifier.events.djAdvance&&this.notifier.notify("Plug.DJ - DJ Advance Update",t.dj.username+" is now playing "+t.media.title+" by "+t.media.author,"http://bug.dj/plug_icon.png"),setTimeout(function(){cplug.settings.autoWootEnabled&&cplug.functions.woot(),API.getWaitListPosition()<0&&API.getUser().id!=API.getDJ().id&&cplug.settings.autoJoinEnabled&&$("#dj-button").click()},3e3)},onVoteUpdate:function(t){"-1"==t.vote&&this.functions.chatLog("#FF0000",t.user.username+" has mehed this song.")},onChat:function(t){console.log(t),"mention"==t.type&&this.settings.notifier.events.chatMention&&this.notifier.notify("Plug.DJ - Mentioned in chat",t.un+": "+t.message,"http://bug.dj/plug_icon.png")},handleChatCommands:function(t){var e=t.replace("@","").split(" ");"/reload"===e[0]&&$.getScript(cpURL),"/skip"===e[0]&&API.moderateForceSkip(),"/kick"===e[0]&&API.moderateBanUser(this.functions.getUserFromArgs(t),1,API.BAN.HOUR),"/ban"===e[0]&&API.moderateBanUser(this.functions.getUserFromArgs(t),1,API.BAN.PERMA),"/mute"===e[0]&&API.moderateMuteUser(this.functions.getUserFromArgs(t),1,API.MUTE.SHORT),"/aw"===e[0]&&(cplug.settings.autoWootEnabled=!cplug.settings.autoWootEnabled,this.settings.autoWootEnabled?this.functions.chatLog("#00FF00","Autowoot enabled!"):this.functions.chatLog("#FF0000","Autowoot disabled!"),this.saveSettings()),"/aj"===e[0]&&(cplug.settings.autoJoinEnabled=!cplug.settings.autoJoinEnabled,this.settings.autoJoinEnabled?this.functions.chatLog("#00FF00","Autojoin enabled!"):this.functions.chatLog("#FF0000","Autojoin disabled!"),this.saveSettings())},notifier:{notify:function(t,e,i){if(!cplug.settings.notifier.showWhenFocused&&!document.hasFocus()||cplug.settings.notifier.showWhenFocused){var n=new Notification(t,{icon:i,body:e});setTimeout(function(){n.close()},cplug.settings.notifyTimeout)}}},functions:{getUserFromArgs:function(t){var e=API.getUsers();for(var i in e)if(t.indexOf(e[i].username)>-1)return e[i].id},woot:function(){$("#woot").click()},meh:function(){$("#meh").click()},chatLog:function(t,e){$('<div class="msg"><div class="text"><span style="color:'+t+'">'+e+"</span></div></div>").appendTo("#chat-messages"),$("#chat-messages").animate({scrollTop:$("#chat-messages")[0].scrollHeight},100)},genCache:function(){var t=API.getUsers();cplug.userCache={};for(var e in t)cplug.userCache[t[e].id]=t[e]},getIDFromCache:function(t){t=t.replace("@","");var e=cplug.userCache;for(var i in e)if(t.indexOf(e[i].username)>-1)return e[i].id},menu:{addItem:function(t,e,i,n,s,o){if(o)var a=cplug.settings[n][s][o];else if(s)var a=cplug.settings[n][s];else var a=cplug.settings[n];$('<div class="'+i+'"><div id="'+e+'" class="item '+(a?"selected":"")+'"><i class="icon icon-check-blue"></i><span>'+t+"</span></div></div>").appendTo("#cplug_settings .container"),$("#"+e).click(function(){o?(cplug.settings[n][s][o]=!cplug.settings[n][s][o],cplug.settings[n][s][o]?$(this).addClass("selected"):$(this).removeClass("selected")):s?(cplug.settings[n][s]=!cplug.settings[n][s],cplug.settings[n][s]?$(this).addClass("selected"):$(this).removeClass("selected")):(cplug.settings[n]=!cplug.settings[n],cplug.settings[n]?$(this).addClass("selected"):$(this).removeClass("selected")),cplug.saveSettings()})},addHeader:function(t){$('<div class="header"><span>'+t+"</span></div>").appendTo("#cplug_settings .container")}}}}),cplug=new cplugModel;